[platformio]
default_envs = sim

[env]
;https://github.com/pioarduino/platform-espressif32/releases/
pioarduino_version = 55.03.31
platform = https://github.com/pioarduino/platform-espressif32/releases/download/${env.pioarduino_version}/platform-espressif32.zip

build_flags =
; Don't use lv_conf.h. Tweak params via platfom.ini.
    -D LV_CONF_SKIP
    -D LV_CONF_INCLUDE_SIMPLE
; Enable LVGL demo, remove when working on your own project
    -D LV_USE_DEMO_WIDGETS=1
; Add more defines below to overide lvgl:/src/lv_conf_simple.h

lib_deps =
    lvgl/lvgl@^9.3.0

[env:board]
;https://github.com/pioarduino/platform-espressif32/blob/main/boards/rymcu-esp32-s3-devkitc-1.json
;https://github.com/platformio/platform-espressif32/blob/develop/boards/rymcu-esp32-s3-devkitc-1.json
board = rymcu-esp32-s3-devkitc-1
framework = arduino
;https://docs.platformio.org/en/latest/projectconf/build_configurations.html
build_type = debug
;https://docs.platformio.org/en/latest/projectconf/sections/env/options/debug/debug_svd_path.html
debug_svd_path = resource/esp32s3.svd

lib_deps =
    ${env.lib_deps}
    bitbank2/bb_spi_lcd@^2.9.7

[env:sim]
;https://registry.platformio.org/platforms/platformio/native
platform = platformio/native@^1.2.1

lib_deps =
    ${env.lib_deps}

extra_scripts =
  post:support/sdl2_build_extra.py

build_flags =
    ${env.build_flags}
; -D LV_LOG_LEVEL=LV_LOG_LEVEL_INFO
    -D LV_LOG_PRINTF=1
; Add recursive dirs for hal headers search
    !python -c "import os; print(' '.join(['-I {}'.format(i[0].replace('\x5C','/')) for i in os.walk('hal/sdl2')]))"
    -lSDL2
; SDL drivers options
    -D LV_LVGL_H_INCLUDE_SIMPLE
    -D LV_DRV_NO_CONF
    -D LV_USE_SDL
    -D SDL_HOR_RES=480
    -D SDL_VER_RES=320
    -D SDL_ZOOM=1
    -D LV_SDL_INCLUDE_PATH="\"SDL2/SDL.h\""
; LVGL memory options, setup for the demo to run properly
    -D LV_MEM_CUSTOM=1
    -D LV_MEM_SIZE="(128U * 1024U)"

build_src_filter =
  +<*>
  +<../hal/sdl2>
  ; Force compile LVGL demo, remove when working on your own project
  +<../.pio/libdeps/sim/lvgl/demos>